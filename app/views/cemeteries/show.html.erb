<% provide(:title, "Map") %>

<body>
<!--  <a href='#' id='export'>Export Features</a>
  <a href='#' id='import'>Import Features</a> -->

  <script>
  var geojsonLayer = new L.GeoJSON.AJAX("/cemeteries/map_data");

  $(document).on('ready page:load', function(event) {
    var Stamen_Watercolor, baseMaps, drawControl, drawnItems, map, opencyclemap, osm, otm, overlayMaps, uploadPopup, measureControl;

    map = L.map("map").setView([56.9558, 24.0991], 13);
    //Window.map =  new L.Map('map');
    //map = L.map("map").setView([56.9558, 24.0991], 13);

    osm = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18
    }, {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);

    otm = L.tileLayer('http://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
      maxZoom: 17,
      attribution: 'Map data: &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'
    });

    Stamen_Watercolor = L.tileLayer('http://stamen-tiles-{s}.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.{ext}', {
      attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
      minZoom: 1,
      maxZoom: 16,
      ext: 'png'
    });

    opencyclemap = L.tileLayer('http://{s}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png?apikey={apikey}', {
      maxZoom: 16,
      attribution: '&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    });

    geojsonLayer.addTo(map);
  /*  geojsonLayer = new L.geoJson();
    geojsonLayer.addTo(map);

    $.ajax({
      dataType: "json",
      url: "/cemeteries.json",
      success: function(data) {
          $(data.features).each(function(key, data) {
              geojsonLayer.addData(data);
          });
      }
      }).error(function() {}); */

    //geojsonLayer.bindPopup(feature.properties.name);

    baseMaps = {
      "OpenStreetMap": osm,
      "OpenTopoMap": otm,
      "Stamen watercolor": Stamen_Watercolor,
      "No map": opencyclemap
    };
    overlayMaps = {
      "GeoJSON": geojsonLayer
    };

    L.control.layers(baseMaps, overlayMaps).addTo(map);

    L.control.scale().addTo(map);

    measureControl = new L.Control.Measure({
      position: 'topright',
      primaryLengthUnit: 'meters',
      secondaryLengthUnit: 'kilometers',
      primaryAreaUnit: 'sqmeters',
      secondaryAreaUnit: 'hectares'
    }).addTo(map);

  });
  </script>
</body>

<!-- A map will magically appear here -->
<div id="map"></div>
